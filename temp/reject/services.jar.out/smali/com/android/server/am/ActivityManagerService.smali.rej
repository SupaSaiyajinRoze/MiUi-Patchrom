*** ActivityManagerService.smali	2017-04-26 08:59:24.469016181 +0000
--- ActivityManagerService.smali	2017-04-26 09:00:53.556968730 +0000
***************
*** 19812,19817 ****
      move-wide/from16 v1, v38
  
      invoke-direct {v0, v1, v2, v5}, Lcom/android/server/am/ActivityManagerService;->checkTime(JLjava/lang/String;)V
      :try_end_2
      .catch Landroid/os/RemoteException; {:try_start_2 .. :try_end_2} :catch_5
      .catchall {:try_start_2 .. :try_end_2} :catchall_0
--- 19837,19868 ----
      move-wide/from16 v1, v38
  
      invoke-direct {v0, v1, v2, v5}, Lcom/android/server/am/ActivityManagerService;->checkTime(JLjava/lang/String;)V
+     
+     if-nez v6, :cond_miui_c
+     
+     invoke-static/range {p5 .. p5}, Lmiui/securityspace/XSpaceUserHandle;->isXSpaceUserId(I)Z
+ 
+     move-result v5
+ 
+     if-eqz v5, :cond_miui_c
+ 
+     const/16 p5, 0x0
+     
+     move/from16 v1, p5
+     
+     invoke-static {}, Landroid/app/AppGlobals;->getPackageManager()Landroid/content/pm/IPackageManager;
+ 
+     move-result-object v5
+ 
+     const/16 v10, 0xc00
+ 
+     move-object/from16 v0, p2
+     
+     invoke-interface {v5, v0, v10, v1}, Landroid/content/pm/IPackageManager;->resolveContentProvider(Ljava/lang/String;II)Landroid/content/pm/ProviderInfo;
+    
+     move-result-object v6
+     
+     :cond_miui_c
      :try_end_2
      .catch Landroid/os/RemoteException; {:try_start_2 .. :try_end_2} :catch_5
      .catchall {:try_start_2 .. :try_end_2} :catchall_0
***************
*** 27084,27089 ****
  
      aput v5, v8, v4
  
      .end local v22    # "mountServiceInternal":Landroid/os/storage/MountServiceInternal;
      .end local v24    # "permGids":[I
      .end local v25    # "pm":Landroid/content/pm/IPackageManager;
--- 27135,27148 ----
  
      aput v5, v8, v4
  
+     invoke-static {v6}, Landroid/os/UserHandle;->getUserId(I)I
+ 
+     move-result v4
+ 
+     invoke-static {v4, v8}, Lcom/android/server/am/ActivityManagerServiceInjector;->computeGids(I[I)[I
+ 
+     move-result-object v8
+ 
      .end local v22    # "mountServiceInternal":Landroid/os/storage/MountServiceInternal;
      .end local v24    # "permGids":[I
      .end local v25    # "pm":Landroid/content/pm/IPackageManager;
